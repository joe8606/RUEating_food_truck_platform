# RUEating API ç«¯é»ç¸½çµ

## ğŸ“‹ æ–°å¢/ä¿®æ”¹çš„ API ç«¯é»

### **é«˜å„ªå…ˆç´šåŠŸèƒ½**

#### 1. **ä¿®æ”¹ï¼šPOST /trucks**
- **åŠŸèƒ½**ï¼šå‰µå»ºæ–°çš„ food truck
- **ä¿®æ”¹**ï¼šæ·»åŠ äº† `owner_user_id` å­—æ®µæ”¯æŒ
- **è«‹æ±‚é«”**ï¼š
  ```json
  {
    "name": "Truck Name",
    "cuisine_tags": ["Mexican", "Latin"],
    "price_tier": "$$",
    "owner_user_id": "user_001"
  }
  ```
- **è¿”å›**ï¼šåŒ…å« `owner_user_id` çš„å®Œæ•´ truck ä¿¡æ¯

---

#### 2. **æ–°å¢ï¼šPOST /trucks/:id/location**
- **åŠŸèƒ½**ï¼šæ›´æ–° truck çš„ä½ç½®
- **è«‹æ±‚é«”**ï¼š
  ```json
  {
    "latitude": 40.5007,
    "longitude": -74.4474,
    "accuracy": 5.0,
    "source": "gps"
  }
  ```
- **èªªæ˜**ï¼š
  - è‡ªå‹•å°‡èˆŠçš„ active ä½ç½®è¨­ç‚º inactive
  - æ’å…¥æ–°çš„ active ä½ç½®è¨˜éŒ„
  - PostGIS trigger è‡ªå‹•è¨ˆç®— `geom` å­—æ®µ

---

#### 3. **æ–°å¢ï¼šGET /trucks/:id/orders**
- **åŠŸèƒ½**ï¼šç²å–ç‰¹å®š truck çš„æ‰€æœ‰è¨‚å–®
- **æŸ¥è©¢åƒæ•¸**ï¼š
  - `status` (å¯é¸)ï¼šæŒ‰ç‹€æ…‹ç¯©é¸ (pending, confirmed, preparing, ready, completed, cancelled)
  - `limit` (å¯é¸)ï¼šé™åˆ¶è¿”å›æ•¸é‡ï¼Œé»˜èª 50
- **è¿”å›**ï¼šåŒ…å«è¨‚å–®è©³æƒ…å’Œè¨‚å–®é …ç›®çš„å®Œæ•´åˆ—è¡¨

---

#### 4. **æ–°å¢ï¼šGET /vendors/:vendor_id/orders**
- **åŠŸèƒ½**ï¼šç²å– vendor æ‰€æœ‰ trucks çš„è¨‚å–®
- **æŸ¥è©¢åƒæ•¸**ï¼š
  - `status` (å¯é¸)ï¼šæŒ‰ç‹€æ…‹ç¯©é¸
  - `limit` (å¯é¸)ï¼šé™åˆ¶è¿”å›æ•¸é‡ï¼Œé»˜èª 50
- **è¿”å›**ï¼šåŒ…å«è¨‚å–®è©³æƒ…å’Œè¨‚å–®é …ç›®çš„å®Œæ•´åˆ—è¡¨

---

#### 5. **æ–°å¢ï¼šPUT /orders/:id/status**
- **åŠŸèƒ½**ï¼šæ›´æ–°è¨‚å–®ç‹€æ…‹
- **è«‹æ±‚é«”**ï¼š
  ```json
  {
    "status": "confirmed"
  }
  ```
- **æœ‰æ•ˆç‹€æ…‹**ï¼špending, confirmed, preparing, ready, completed, cancelled
- **è¿”å›**ï¼šæ›´æ–°å¾Œçš„å®Œæ•´è¨‚å–®ä¿¡æ¯

---

#### 6. **æ–°å¢ï¼šGET /vendors/:vendor_id/trucks**
- **åŠŸèƒ½**ï¼šç²å– vendor æ“æœ‰çš„æ‰€æœ‰ trucks
- **è¿”å›**ï¼šåŒ…å«æœ€æ–°ä½ç½®ä¿¡æ¯çš„ truck åˆ—è¡¨

---

### **ä¸­å„ªå…ˆç´šåŠŸèƒ½**

#### 7. **æ–°å¢ï¼šPOST /trucks/:id/menu/items**
- **åŠŸèƒ½**ï¼šå‰µå»ºæ–°çš„èœå–®é …ç›®
- **è«‹æ±‚é«”**ï¼š
  ```json
  {
    "name": "Beef Tacos",
    "description": "Traditional beef tacos",
    "price": 8.99,
    "dietary_tags": ["Gluten-Free"],
    "available": true
  }
  ```
- **èªªæ˜**ï¼šè‡ªå‹•æ·»åŠ åˆ°ç•¶å‰æ´»èºçš„ menu_version

---

#### 8. **æ–°å¢ï¼šPUT /menu-items/:id**
- **åŠŸèƒ½**ï¼šæ›´æ–°èœå–®é …ç›®
- **è«‹æ±‚é«”**ï¼ˆæ‰€æœ‰å­—æ®µå¯é¸ï¼‰ï¼š
  ```json
  {
    "name": "Updated Name",
    "description": "Updated description",
    "price": 9.99,
    "dietary_tags": ["Vegan"],
    "available": false
  }
  ```
- **è¿”å›**ï¼šæ›´æ–°å¾Œçš„èœå–®é …ç›®ä¿¡æ¯

---

#### 9. **æ–°å¢ï¼šDELETE /menu-items/:id**
- **åŠŸèƒ½**ï¼šåˆªé™¤èœå–®é …ç›®
- **è¿”å›**ï¼šæˆåŠŸæ¶ˆæ¯

---

#### 10. **æ–°å¢ï¼šGET /trucks/:id/schedule**
- **åŠŸèƒ½**ï¼šç²å– truck çš„ç‡Ÿæ¥­æ™‚é–“
- **è¿”å›**ï¼šæŒ‰æ˜ŸæœŸæ’åºçš„ç‡Ÿæ¥­æ™‚é–“åˆ—è¡¨

---

#### 11. **æ–°å¢ï¼šPOST /trucks/:id/schedule**
- **åŠŸèƒ½**ï¼šå‰µå»ºç‡Ÿæ¥­æ™‚é–“è¨˜éŒ„
- **è«‹æ±‚é«”**ï¼š
  ```json
  {
    "day_of_week": "Monday",
    "start_time": "10:00",
    "end_time": "18:00",
    "typical_location": "Rutgers Student Center"
  }
  ```
- **æœ‰æ•ˆæ˜ŸæœŸ**ï¼šMonday, Tuesday, Wednesday, Thursday, Friday, Saturday, Sunday

---

#### 12. **æ–°å¢ï¼šPUT /schedule/:id**
- **åŠŸèƒ½**ï¼šæ›´æ–°ç‡Ÿæ¥­æ™‚é–“
- **è«‹æ±‚é«”**ï¼ˆæ‰€æœ‰å­—æ®µå¯é¸ï¼‰ï¼š
  ```json
  {
    "day_of_week": "Tuesday",
    "start_time": "11:00",
    "end_time": "19:00",
    "typical_location": "New Location"
  }
  ```

---

#### 13. **æ–°å¢ï¼šDELETE /schedule/:id**
- **åŠŸèƒ½**ï¼šåˆªé™¤ç‡Ÿæ¥­æ™‚é–“è¨˜éŒ„
- **è¿”å›**ï¼šæˆåŠŸæ¶ˆæ¯

---

#### 14. **æ–°å¢ï¼šPUT /trucks/:id**
- **åŠŸèƒ½**ï¼šæ›´æ–° truck åŸºæœ¬ä¿¡æ¯
- **è«‹æ±‚é«”**ï¼ˆæ‰€æœ‰å­—æ®µå¯é¸ï¼‰ï¼š
  ```json
  {
    "name": "Updated Truck Name",
    "cuisine_tags": ["Mexican", "Latin", "Spicy"],
    "price_tier": "$$$"
  }
  ```
- **è¿”å›**ï¼šæ›´æ–°å¾Œçš„å®Œæ•´ truck ä¿¡æ¯

---

#### 15. **æ–°å¢ï¼šPUT /trucks/:id/status**
- **åŠŸèƒ½**ï¼šåˆ‡æ› truck ç‡Ÿæ¥­ç‹€æ…‹ï¼ˆé–‹/é—œï¼‰
- **è«‹æ±‚é«”**ï¼š
  ```json
  {
    "is_open_now": true
  }
  ```
- **è¿”å›**ï¼šæ›´æ–°å¾Œçš„ç‹€æ…‹ä¿¡æ¯

---

## ğŸ“Š API ç«¯é»çµ±è¨ˆ

### ç¸½è¨ˆ
- **ä¿®æ”¹çš„ç«¯é»**ï¼š1 å€‹
- **æ–°å¢çš„ç«¯é»**ï¼š14 å€‹
- **ç¸½ç«¯é»æ•¸**ï¼š15 å€‹

### åˆ†é¡çµ±è¨ˆ
- **Truck ç®¡ç†**ï¼š4 å€‹ï¼ˆå‰µå»ºã€ç·¨è¼¯ã€ç‹€æ…‹ã€ä½ç½®ï¼‰
- **è¨‚å–®ç®¡ç†**ï¼š3 å€‹ï¼ˆæŸ¥çœ‹ truck è¨‚å–®ã€æŸ¥çœ‹ vendor è¨‚å–®ã€æ›´æ–°ç‹€æ…‹ï¼‰
- **èœå–®ç®¡ç†**ï¼š3 å€‹ï¼ˆå‰µå»ºã€æ›´æ–°ã€åˆªé™¤ï¼‰
- **ç‡Ÿæ¥­æ™‚é–“ç®¡ç†**ï¼š4 å€‹ï¼ˆæŸ¥çœ‹ã€å‰µå»ºã€æ›´æ–°ã€åˆªé™¤ï¼‰
- **Vendor å°ˆç”¨**ï¼š1 å€‹ï¼ˆæŸ¥çœ‹ vendor çš„ trucksï¼‰

---

## ğŸ”’ æ¬Šé™èªªæ˜

**ç•¶å‰å¯¦ç¾**ï¼š
- æ‰€æœ‰ç«¯é»éƒ½å¯ä»¥è¨ªå•ï¼ˆç„¡èº«ä»½é©—è­‰ï¼‰
- å»ºè­°å¾ŒçºŒæ·»åŠ  JWT èªè­‰ä¸­é–“ä»¶
- å»ºè­°æ·»åŠ æ¬Šé™é©—è­‰ï¼ˆç¢ºä¿ vendor åªèƒ½ç®¡ç†è‡ªå·±çš„ trucksï¼‰

**æ¬Šé™é©—è­‰å»ºè­°**ï¼š
```javascript
// ç¤ºä¾‹ï¼šé©—è­‰ vendor æ˜¯å¦æ“æœ‰è©² truck
const verifyTruckOwner = async (truckId, vendorId) => {
  const result = await pool.query(`
    SELECT owner_user_id FROM food_truck WHERE truck_id = $1
  `, [truckId]);
  return result.rows[0]?.owner_user_id === vendorId;
};
```

---

## ğŸ§ª æ¸¬è©¦å»ºè­°

### æ¸¬è©¦æµç¨‹
1. **å‰µå»º Truck**
   ```
   POST /trucks
   ```

2. **æ›´æ–°ä½ç½®**
   ```
   POST /trucks/{truck_id}/location
   ```

3. **å‰µå»ºèœå–®é …ç›®**
   ```
   POST /trucks/{truck_id}/menu/items
   ```

4. **å‰µå»ºç‡Ÿæ¥­æ™‚é–“**
   ```
   POST /trucks/{truck_id}/schedule
   ```

5. **æŸ¥çœ‹è¨‚å–®**
   ```
   GET /trucks/{truck_id}/orders
   ```

6. **æ›´æ–°è¨‚å–®ç‹€æ…‹**
   ```
   PUT /orders/{order_id}/status
   ```

7. **ç·¨è¼¯ Truck ä¿¡æ¯**
   ```
   PUT /trucks/{truck_id}
   ```

8. **åˆ‡æ›ç‡Ÿæ¥­ç‹€æ…‹**
   ```
   PUT /trucks/{truck_id}/status
   ```

---

## ğŸ“ æ³¨æ„äº‹é …

1. **ä½ç½®æ›´æ–°**ï¼š
   - æ¯æ¬¡æ›´æ–°ä½ç½®æœƒè‡ªå‹•å°‡èˆŠçš„ active è¨˜éŒ„è¨­ç‚º inactive
   - PostGIS trigger è‡ªå‹•è™•ç† `geom` å­—æ®µ

2. **èœå–®ç®¡ç†**ï¼š
   - å‰µå»ºèœå–®é …ç›®éœ€è¦å…ˆæœ‰æ´»èºçš„ menu_version
   - å¦‚æœæ²’æœ‰ï¼Œéœ€è¦å…ˆå‰µå»º menu_version

3. **ç‡Ÿæ¥­æ™‚é–“**ï¼š
   - æ¯å€‹æ˜ŸæœŸåªèƒ½æœ‰ä¸€å€‹ç‡Ÿæ¥­æ™‚é–“è¨˜éŒ„
   - å¦‚æœå·²å­˜åœ¨ï¼Œéœ€è¦å…ˆåˆªé™¤æˆ–æ›´æ–°

4. **è¨‚å–®ç‹€æ…‹**ï¼š
   - ç‹€æ…‹è½‰æ›æ²’æœ‰å¼·åˆ¶é©—è­‰ï¼ˆå¯ä»¥å¾ä»»ä½•ç‹€æ…‹è½‰åˆ°ä»»ä½•ç‹€æ…‹ï¼‰
   - å»ºè­°å¾ŒçºŒæ·»åŠ ç‹€æ…‹è½‰æ›é©—è­‰é‚è¼¯

5. **æ•¸æ“šé©—è­‰**ï¼š
   - æ‰€æœ‰ç«¯é»éƒ½åŒ…å«åŸºæœ¬çš„æ•¸æ“šé©—è­‰
   - å»ºè­°æ·»åŠ æ›´åš´æ ¼çš„æ¥­å‹™é‚è¼¯é©—è­‰

---

## âœ… å®Œæˆç‹€æ…‹

- âœ… æ‰€æœ‰é«˜å„ªå…ˆç´šåŠŸèƒ½å·²å®Œæˆ
- âœ… æ‰€æœ‰ä¸­å„ªå…ˆç´šåŠŸèƒ½å·²å®Œæˆ
- âœ… ä»£ç¢¼é€šéèªæ³•æª¢æŸ¥
- âœ… ç„¡ linter éŒ¯èª¤
- â³ ç­‰å¾…æ¸¬è©¦


